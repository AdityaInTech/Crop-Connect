<!DOCTYPE html>
<html lang="en">

<head>
    {{!--
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Crops | {{details.brandName}}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />--}}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Crops | {{details.brandName}}</title>

    <link rel="stylesheet" href="/static/css/style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f5fff5;
            font-family: 'Poppins', sans-serif;
        }

        .form-control {
            border: 1px solid rgba(0, 0, 0, 0.7);
            border-radius: 5px;
        }

        .crop-card {
            transition: transform 0.4s, box-shadow 0.3s;
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
            height: 100%;
        }

        .card-body {
            padding: 1.2rem;
        }

        .crop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 10px rgba(0, 0, 0, 0.6) !important;
        }

        .image-wrapper {
            padding: 6px;
            background-color: #fff;
        }

        .card-img-top {
            width: 100%;
            height: 200px;
            object-fit: cover;
            object-position: center center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }

        .crop-card img {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

            {
                {
                !-- .modal-img {
                    width: 100%;
                    border-radius: 10px;
                }

                --
            }
        }

        .modal-img {
            max-width: 90%;
            max-height: 80vh;
            width: auto;
            height: auto;
            display: block;
            margin: 0 auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .modal-content.bg-transparent {
            background-color: rgba(0, 0, 0, 0.8) !important;
        }
    </style>
</head>

<body>

    {{>navbar data=details}}

    <section class="container py-5">
        <div class="row mb-4 justify-content-center">
            <div class="col-md-6 ">
                <input type="text" id="searchInput" class="form-control"
                    placeholder="Search crops by name, variety, or location...">
            </div>
        </div>
        <h2 class="text-success text-center my-4">Available Crops</h2>

        <div class="row">
            {{#each crops}}
            <div class="col-md-4 mb-3">
                <div class="card crop-card">
                    {{#if image}}
                    <div class="image-wrapper">
                        <img src="{{image}}" class="card-img-top" alt="{{crop_name}}"
                            onclick="openImageModal('{{image}}')">
                    </div>
                    {{/if}}
                    <div class="card-body">
                        <h5 class="card-title">{{crop_name}} - {{crop_variety}}</h5>
                        <p class="card-text">Quantity: {{quantity}} kg</p>
                        <p class="card-text">Price: ₹{{price}}/kg {{#if negotiable}}(Negotiable){{/if}}</p>
                        <p class="card-text">Condition: {{condition}}</p>
                        <p class="card-text">Location: {{this.country}} - {{state}} - {{location}}</p>
                        <p class="card-text">Owner: {{owner_name}} |
                            <button class="btn btn-sm btn-success contact-btn" data-owner="{{owner_name}}"
                                data-crop="{{crop_name}}" data-contact="{{owner_contact}}">
                                Contact Owner
                            </button>
                        </p>
                        {{!-- Added Posted Date --}}
                        <p class="text-muted">Posted on: {{formatDate createdAt}}</p>

                        {{!-- Added View Description Button  --}}
                        <div class="text-start">
                            <button class="btn btn-outline-primary btn-sm desc-btn" data-name="{{crop_name}}"
                                data-variety="{{crop_variety}}" data-description="{{description}}">
                                View Description
                            </button>
                        </div>
                         {{!-- End of Added Button  --}}
                    </div>
                </div>
            </div>
            {{/each}}

            {{#unless crops.length}}
            <p class="text-center text-muted">No crops available at the moment.</p>
            {{/unless}}
        </div>
    </section>

     {{!-- Contact Modal --}}
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Owner Contact</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="modal-contact-info">Please complete payment to see contact info.</p>
                    <button id="payButton" class="btn btn-primary">Pay ₹50 </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        {{!-- <div class="modal-dialog modal-dialog-centered modal-lg"> --}}
            <div class="modal-dialog modal-dialog-centered">
                {{!-- <div class="modal-content bg-transparent border-0"> --}}
                    <div class="modal-content bg-transparent border-0 d-flex justify-content-center align-items-center">
                        <img id="modalImage" class="modal-img" src="" alt="Full Crop Image">
                    </div>
                </div>
            </div>

            <!-- Description Modal Added -->
            <div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-success text-white">
                            <h5 class="modal-title" id="descriptionModalLabel">Crop Description</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <h5 id="descCropName" class="text-success"></h5>
                            <p id="descContent" class="mt-2 text-dark"></p>
                        </div>
                    </div>
                </div>
            </div>
            {{!--  End of Description Modal  --}}

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

            {{!-- Contact Logic --}}
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const contactBtns = document.querySelectorAll(".contact-btn");
                    const modalContactInfo = document.getElementById("modal-contact-info");
                    const payButton = document.getElementById("payButton");
                    let selectedContact = "";

                    contactBtns.forEach(btn => {
                        btn.addEventListener("click", function () {
                            selectedContact = btn.getAttribute("data-contact");
                            modalContactInfo.textContent = "Please complete payment to see contact info.";
                            payButton.style.display = "inline-block";
                            const contactModal = new bootstrap.Modal(document.getElementById('contactModal'));
                            contactModal.show();
                        });
                    });

                    payButton.addEventListener("click", function () {
                        modalContactInfo.textContent = "Contact: " + selectedContact;
                        payButton.style.display = "none";
                    });
                });
            </script>

            {{!-- Image Logic --}}
            <script>
                function openImageModal(imageSrc) {
                    document.getElementById("modalImage").src = imageSrc;
                    const imageModal = new bootstrap.Modal(document.getElementById("imageModal"));
                    imageModal.show();
                }
            </script>

            {{!-- Search Bar Logic --}}
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const searchInput = document.getElementById("searchInput");
                    const cropCards = document.querySelectorAll(".crop-card");

                    searchInput.addEventListener("input", function () {
                        const filter = searchInput.value.toLowerCase();

                        cropCards.forEach(card => {
                            const cropName = card.querySelector(".card-title").textContent.toLowerCase();
                            const location = card.querySelector(".card-text:nth-of-type(4)").textContent.toLowerCase();
                            if (cropName.includes(filter) || location.includes(filter)) {
                                card.parentElement.style.display = "";
                            } else {
                                card.parentElement.style.display = "none";
                            }
                        });
                    });
                });
            </script>

            <!-- ✅ Description Logic Script -->
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const descButtons = document.querySelectorAll(".desc-btn");
                    const descModal = new bootstrap.Modal(document.getElementById("descriptionModal"));
                    const descCropName = document.getElementById("descCropName");
                    const descContent = document.getElementById("descContent");

                    descButtons.forEach(btn => {
                        btn.addEventListener("click", function () {
                            const cropName = btn.getAttribute("data-name");
                            const variety = btn.getAttribute("data-variety");
                            const description = btn.getAttribute("data-description") || "No description provided for this crop.";

                            descCropName.textContent = `${cropName} - ${variety}`;
                            descContent.textContent = description;
                            descModal.show();
                        });
                    });
                });
            </script>
            <!-- ✅ End of Description Logic -->
            {{>footer}}
            {{!-- {{>footer footer=footer}} --}}


</body>

</html>